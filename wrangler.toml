name = "llm-benchmarks"
main = "src/index.ts"
compatibility_date = "2026-01-01"
compatibility_flags = ["nodejs_compat"]
account_id = "facf6619808dc039df729531bbb26d1d"

[build]
command = "npm run build:frontend"

[[routes]]
pattern = "benchmarks.emilycogsdill.com"
custom_domain = true

[assets]
directory = "./dist"
not_found_handling = "single-page-application"
binding = "ASSETS"
run_worker_first = true

[[d1_databases]]
binding = "DB"
database_name = "llm-benchmarks-db"
database_id = "1387e6df-d3a9-4b13-80d8-c01c846232a3"

[observability]
enabled = true

# Cron trigger for scheduled benchmarks (every minute)
[triggers]
crons = ["* * * * *"]

# Durable Object for schedule deduplication
[[durable_objects.bindings]]
name = "BENCHMARK_SCHEDULER"
class_name = "BenchmarkSchedulerDO"

[[migrations]]
tag = "v1"
new_classes = ["BenchmarkSchedulerDO"]

# Container for running benchmarks
[[containers]]
class_name = "BenchmarkContainer"
image = "./Dockerfile"
max_instances = 4

[[durable_objects.bindings]]
name = "BENCHMARK_CONTAINER"
class_name = "BenchmarkContainer"

[[migrations]]
tag = "v2"
new_sqlite_classes = ["BenchmarkContainer"]

[vars]
# API keys should be set via wrangler secret:
# wrangler secret put ADMIN_API_KEY
# wrangler secret put ANTHROPIC_API_KEY
# wrangler secret put OPENAI_API_KEY
